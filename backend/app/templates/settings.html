{% extends "base.html" %}

{% block title %}ì„¤ì • - US Stock Trading Bot{% endblock %}

{% block content %}
<h1>ì„¤ì •</h1>

{% if error %}
<div class="alert alert-error">{{ error }}</div>
{% endif %}

{% if success %}
<div class="alert alert-success">{{ success }}</div>
{% endif %}

<!-- API í‚¤ ì„¤ì • -->
<div class="card">
    <h2>ğŸ”‘ API í‚¤ ê´€ë¦¬</h2>

    <form method="post" action="/settings/save-keys" style="margin-bottom: 2rem;">
        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">App Key</label>
            <input type="text" name="app_key" value="{{ api_keys.get('app_key', '') }}" placeholder="í•œêµ­íˆ¬ìì¦ê¶Œ App Key ì…ë ¥" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">App Secret</label>
            <input type="password" name="app_secret" value="{{ api_keys.get('app_secret', '') }}" placeholder="í•œêµ­íˆ¬ìì¦ê¶Œ App Secret ì…ë ¥" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ê³„ì¢Œë²ˆí˜¸</label>
            <input type="text" name="account_number" value="{{ api_keys.get('account_number', '') }}" placeholder="ê³„ì¢Œë²ˆí˜¸ ì…ë ¥ (ì˜ˆ: 12345678-01)" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">í˜•ì‹: 12345678-01</small>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="paper_mode" value="true" {% if paper_mode %}checked{% endif %} style="margin-right: 0.5rem;">
                <span>ëª¨ì˜ íˆ¬ì ëª¨ë“œ (Paper Trading)</span>
            </label>
        </div>

        <button type="submit" class="success">ì €ì¥</button>
    </form>

    {% if api_keys %}
    <div style="padding: 1rem; background: #f8f9fa; border-radius: 4px; margin-top: 1rem;">
        <h3 style="margin-top: 0; font-size: 0.95rem; color: #666;">í˜„ì¬ ì„¤ì •ëœ API í‚¤</h3>
        <ul style="margin: 0; padding-left: 1.5rem;">
            {% if api_keys.get('app_key') %}
            <li>App Key: {{ api_keys.get('app_key')[:8] }}... âœ“</li>
            {% endif %}
            {% if api_keys.get('app_secret') %}
            <li>App Secret: ********** âœ“</li>
            {% endif %}
            {% if api_keys.get('account_number') %}
            <li>ê³„ì¢Œë²ˆí˜¸: {{ api_keys.get('account_number') }} âœ“</li>
            {% endif %}
        </ul>
    </div>
    {% else %}
    <div style="padding: 1rem; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin-top: 1rem;">
        <p style="margin: 0; color: #856404;">âš ï¸ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê±°ë˜ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìœ„ ì–‘ì‹ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.</p>
    </div>
    {% endif %}
</div>

<!-- ë¦¬ìŠ¤í¬ íŒŒë¼ë¯¸í„° -->
<div class="card">
    <h2>âš™ï¸ ë¦¬ìŠ¤í¬ íŒŒë¼ë¯¸í„°</h2>

    <form method="post" action="/settings/save-risk-params">
        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ìµœëŒ€ í¬ì§€ì…˜ ìˆ˜</label>
            <input type="number" name="max_positions" value="{{ risk_params.max_positions }}" min="1" max="20" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">ë™ì‹œì— ë³´ìœ í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ì¢…ëª© ìˆ˜</small>
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">í¬ì§€ì…˜ë‹¹ ìµœëŒ€ ë¹„ì¤‘ (%)</label>
            <input type="number" name="max_position_size_pct" value="{{ risk_params.max_position_size_pct }}" min="1" max="100" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">ì „ì²´ ìì‚° ëŒ€ë¹„ í•œ ì¢…ëª©ì˜ ìµœëŒ€ ë¹„ì¤‘</small>
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì†ì ˆ ê¸°ì¤€ (%)</label>
            <input type="number" name="stop_loss_pct" value="{{ risk_params.stop_loss_pct }}" min="1" max="50" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">ë§¤ìˆ˜ê°€ ëŒ€ë¹„ ì†ì‹¤ ì‹œ ìë™ ë§¤ë„ ê¸°ì¤€</small>
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ìµì ˆ ê¸°ì¤€ (%)</label>
            <input type="number" name="take_profit_pct" value="{{ risk_params.take_profit_pct }}" min="1" max="200" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">ë§¤ìˆ˜ê°€ ëŒ€ë¹„ ì´ìµ ì‹œ ìë™ ë§¤ë„ ê¸°ì¤€</small>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì¼ì¼ ìµœëŒ€ ì†ì‹¤ë¥  (ì„œí‚·ë¸Œë ˆì´ì»¤) (%)</label>
            <input type="number" name="daily_loss_limit_pct" value="{{ risk_params.daily_loss_limit_pct }}" min="1" max="50" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">ì¼ì¼ ì†ì‹¤ì´ ì´ ë¹„ìœ¨ ì´ˆê³¼ ì‹œ ëª¨ë“  ê±°ë˜ ì¤‘ë‹¨</small>
        </div>

        <button type="submit" class="success">ì €ì¥</button>
    </form>
</div>

<!-- ì‹œìŠ¤í…œ ì •ë³´ -->
<div class="card">
    <h2>â„¹ï¸ ì‹œìŠ¤í…œ ì •ë³´</h2>
    <table>
        <tbody>
            <tr>
                <td><strong>ë²„ì „</strong></td>
                <td>1.0.0</td>
            </tr>
            <tr>
                <td><strong>ë°ì´í„°ë² ì´ìŠ¤</strong></td>
                <td>SQLite</td>
            </tr>
            <tr>
                <td><strong>ë¸Œë¡œì»¤</strong></td>
                <td>í•œêµ­íˆ¬ìì¦ê¶Œ</td>
            </tr>
            <tr>
                <td><strong>ìš´ì˜ ëª¨ë“œ</strong></td>
                <td>{% if paper_mode %}ëª¨ì˜ íˆ¬ì{% else %}ì‹¤ì „ íˆ¬ì{% endif %}</td>
            </tr>
        </tbody>
    </table>
</div>

{% endblock %}

{% block scripts %}
<script>
    // í¼ ì œì¶œ ì‹œ í™•ì¸
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', (e) => {
            const btn = form.querySelector('button[type="submit"]');
            if (btn) {
                btn.disabled = true;
                btn.textContent = 'ì €ì¥ ì¤‘...';
            }
        });
    });
</script>
{% endblock %}
