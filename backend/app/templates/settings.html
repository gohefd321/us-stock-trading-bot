{% extends "base.html" %}

{% block title %}ì„¤ì • - US Stock Trading Bot{% endblock %}

{% block content %}
<h1>ì„¤ì •</h1>

{% if error %}
<div class="alert alert-error">{{ error }}</div>
{% endif %}

{% if success %}
<div class="alert alert-success">{{ success }}</div>
{% endif %}

<!-- API í‚¤ ì„¤ì • -->
<div class="card">
    <h2>ğŸ”‘ API í‚¤ ê´€ë¦¬</h2>

    <form method="post" action="/settings/save-keys" style="margin-bottom: 2rem;">
        <h3 style="margin-top: 0; font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem;">í•œêµ­íˆ¬ìì¦ê¶Œ API</h3>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">App Key</label>
            <input type="text" name="app_key" value="{{ api_keys.get('app_key', '') }}" placeholder="í•œêµ­íˆ¬ìì¦ê¶Œ App Key ì…ë ¥" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">App Secret</label>
            <input type="password" name="app_secret" value="{{ api_keys.get('app_secret', '') }}" placeholder="í•œêµ­íˆ¬ìì¦ê¶Œ App Secret ì…ë ¥" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ê³„ì¢Œë²ˆí˜¸</label>
            <input type="text" name="account_number" value="{{ api_keys.get('account_number', '') }}" placeholder="ê³„ì¢Œë²ˆí˜¸ ì…ë ¥ (ì˜ˆ: 12345678-01)" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">í˜•ì‹: 12345678-01</small>
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ê³„ì¢Œ ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" name="account_password" value="{{ api_keys.get('account_password', '') }}" placeholder="ê³„ì¢Œ ë¹„ë°€ë²ˆí˜¸ (í•´ì™¸ì£¼ì‹ ê±°ë˜ìš©)" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">âš ï¸ í•´ì™¸ì£¼ì‹ ê±°ë˜ ì‹œ í•„ìˆ˜ (4ìë¦¬ ìˆ«ì)</small>
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="password_padding" value="true" {% if password_padding %}checked{% endif %} style="margin-right: 0.5rem;">
                <span>ë¹„ë°€ë²ˆí˜¸ 8ìë¦¬ íŒ¨ë”© ì‚¬ìš© (4ìë¦¬ â†’ 8ìë¦¬ ê³µë°± íŒ¨ë”©)</span>
            </label>
            <small style="color: #666; display: block; margin-top: 0.25rem; margin-left: 1.75rem;">ì¼ë¶€ APIì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ 8ìë¦¬ë¡œ ìš”êµ¬í•˜ëŠ” ê²½ìš° ì²´í¬</small>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="paper_mode" value="true" {% if paper_mode %}checked{% endif %} style="margin-right: 0.5rem;">
                <span>ëª¨ì˜ íˆ¬ì ëª¨ë“œ (Paper Trading)</span>
            </label>
        </div>

        <h3 style="font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem; margin-top: 2rem;">Google Gemini API</h3>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Gemini API Key</label>
            <input type="password" name="gemini_api_key" value="{{ api_keys.get('gemini_api_key', '') }}" placeholder="Google Gemini API Key ì…ë ¥" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">AI ê±°ë˜ ê²°ì •ì— ì‚¬ìš©ë©ë‹ˆë‹¤</small>
        </div>

        <h3 style="font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem; margin-top: 2rem;">Reddit API (WSB ìŠ¤í¬ë˜í•‘)</h3>

        <div style="padding: 1rem; background: #e7f3ff; border: 1px solid #0066cc; border-radius: 4px; margin-bottom: 1rem;">
            <p style="margin: 0 0 0.5rem 0; color: #0066cc; font-weight: 500;">ğŸ“˜ Reddit API í‚¤ ë°œê¸‰ ë°©ë²•:</p>
            <ol style="margin: 0; padding-left: 1.5rem; color: #333; font-size: 0.9rem;">
                <li><a href="https://www.reddit.com/prefs/apps" target="_blank" style="color: #0066cc;">https://www.reddit.com/prefs/apps</a> ì ‘ì†</li>
                <li>"create another app..." í´ë¦­</li>
                <li>ì•± íƒ€ì…: "script" ì„ íƒ</li>
                <li>ì´ë¦„: ì›í•˜ëŠ” ì´ë¦„ ì…ë ¥ (ì˜ˆ: TradingBot)</li>
                <li>redirect uri: http://localhost:8000</li>
                <li>Client IDì™€ Secret ë³µì‚¬í•˜ì—¬ ì•„ë˜ì— ì…ë ¥</li>
            </ol>
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Reddit Client ID</label>
            <input type="text" name="reddit_client_id" value="{{ api_keys.get('reddit_client_id', '') }}" placeholder="Reddit Client ID ì…ë ¥" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Reddit Client Secret</label>
            <input type="password" name="reddit_client_secret" value="{{ api_keys.get('reddit_client_secret', '') }}" placeholder="Reddit Client Secret ì…ë ¥" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Reddit User Agent</label>
            <input type="text" name="reddit_user_agent" value="{{ api_keys.get('reddit_user_agent', '') }}" placeholder="ì˜ˆ: MyTradingBot/1.0" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">WallStreetBets íŠ¸ë Œë”© ì¢…ëª© ìˆ˜ì§‘ì— ì‚¬ìš©ë©ë‹ˆë‹¤</small>
        </div>

        <button type="submit" class="success">ì €ì¥</button>
    </form>

    {% if api_keys %}
    <div style="padding: 1rem; background: #f8f9fa; border-radius: 4px; margin-top: 1rem;">
        <h3 style="margin-top: 0; font-size: 0.95rem; color: #666;">í˜„ì¬ ì„¤ì •ëœ API í‚¤</h3>
        <ul style="margin: 0; padding-left: 1.5rem;">
            {% if api_keys.get('app_key') %}
            <li><strong>í•œíˆ¬ App Key:</strong> {{ api_keys.get('app_key')[:8] }}... âœ“</li>
            {% endif %}
            {% if api_keys.get('app_secret') %}
            <li><strong>í•œíˆ¬ App Secret:</strong> ********** âœ“</li>
            {% endif %}
            {% if api_keys.get('account_number') %}
            <li><strong>ê³„ì¢Œë²ˆí˜¸:</strong> {{ api_keys.get('account_number') }} âœ“</li>
            {% endif %}
            {% if api_keys.get('account_password') %}
            <li><strong>ê³„ì¢Œ ë¹„ë°€ë²ˆí˜¸:</strong> **** âœ“</li>
            {% endif %}
            {% if api_keys.get('gemini_api_key') %}
            <li><strong>Gemini API Key:</strong> {{ api_keys.get('gemini_api_key')[:8] }}... âœ“</li>
            {% endif %}
            {% if api_keys.get('reddit_client_id') %}
            <li><strong>Reddit Client ID:</strong> {{ api_keys.get('reddit_client_id')[:8] }}... âœ“</li>
            {% endif %}
            {% if api_keys.get('reddit_client_secret') %}
            <li><strong>Reddit Client Secret:</strong> ********** âœ“</li>
            {% endif %}
            {% if api_keys.get('reddit_user_agent') %}
            <li><strong>Reddit User Agent:</strong> {{ api_keys.get('reddit_user_agent') }} âœ“</li>
            {% endif %}
        </ul>
    </div>
    {% else %}
    <div style="padding: 1rem; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin-top: 1rem;">
        <p style="margin: 0; color: #856404;">âš ï¸ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê±°ë˜ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìœ„ ì–‘ì‹ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.</p>
    </div>
    {% endif %}
</div>

<!-- ë¦¬ìŠ¤í¬ íŒŒë¼ë¯¸í„° -->
<div class="card">
    <h2>âš™ï¸ ë¦¬ìŠ¤í¬ íŒŒë¼ë¯¸í„°</h2>

    <form method="post" action="/settings/save-risk-params">
        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ìµœëŒ€ í¬ì§€ì…˜ ìˆ˜</label>
            <input type="number" name="max_positions" value="{{ risk_params.max_positions }}" min="1" max="20" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">ë™ì‹œì— ë³´ìœ í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ì¢…ëª© ìˆ˜</small>
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">í¬ì§€ì…˜ë‹¹ ìµœëŒ€ ë¹„ì¤‘ (%)</label>
            <input type="number" name="max_position_size_pct" value="{{ risk_params.max_position_size_pct }}" min="1" max="100" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">ì „ì²´ ìì‚° ëŒ€ë¹„ í•œ ì¢…ëª©ì˜ ìµœëŒ€ ë¹„ì¤‘</small>
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì†ì ˆ ê¸°ì¤€ (%)</label>
            <input type="number" name="stop_loss_pct" value="{{ risk_params.stop_loss_pct }}" min="1" max="50" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">ë§¤ìˆ˜ê°€ ëŒ€ë¹„ ì†ì‹¤ ì‹œ ìë™ ë§¤ë„ ê¸°ì¤€</small>
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ìµì ˆ ê¸°ì¤€ (%)</label>
            <input type="number" name="take_profit_pct" value="{{ risk_params.take_profit_pct }}" min="1" max="200" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">ë§¤ìˆ˜ê°€ ëŒ€ë¹„ ì´ìµ ì‹œ ìë™ ë§¤ë„ ê¸°ì¤€</small>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì¼ì¼ ìµœëŒ€ ì†ì‹¤ë¥  (ì„œí‚·ë¸Œë ˆì´ì»¤) (%)</label>
            <input type="number" name="daily_loss_limit_pct" value="{{ risk_params.daily_loss_limit_pct }}" min="1" max="50" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;">
            <small style="color: #666; display: block; margin-top: 0.25rem;">ì¼ì¼ ì†ì‹¤ì´ ì´ ë¹„ìœ¨ ì´ˆê³¼ ì‹œ ëª¨ë“  ê±°ë˜ ì¤‘ë‹¨</small>
        </div>

        <button type="submit" class="success">ì €ì¥</button>
    </form>
</div>

<!-- ì‹œìŠ¤í…œ ì •ë³´ -->
<div class="card">
    <h2>â„¹ï¸ ì‹œìŠ¤í…œ ì •ë³´</h2>
    <table>
        <tbody>
            <tr>
                <td><strong>ë²„ì „</strong></td>
                <td>1.0.0</td>
            </tr>
            <tr>
                <td><strong>ë°ì´í„°ë² ì´ìŠ¤</strong></td>
                <td>SQLite</td>
            </tr>
            <tr>
                <td><strong>ë¸Œë¡œì»¤</strong></td>
                <td>í•œêµ­íˆ¬ìì¦ê¶Œ</td>
            </tr>
            <tr>
                <td><strong>ìš´ì˜ ëª¨ë“œ</strong></td>
                <td>{% if paper_mode %}ëª¨ì˜ íˆ¬ì{% else %}ì‹¤ì „ íˆ¬ì{% endif %}</td>
            </tr>
        </tbody>
    </table>
</div>

{% endblock %}

{% block scripts %}
<script>
    // í¼ ì œì¶œ ì‹œ í™•ì¸
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', (e) => {
            const btn = form.querySelector('button[type="submit"]');
            if (btn) {
                btn.disabled = true;
                btn.textContent = 'ì €ì¥ ì¤‘...';
            }
        });
    });
</script>
{% endblock %}
