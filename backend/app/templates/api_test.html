{% extends "base.html" %}

{% block title %}API í…ŒìŠ¤íŠ¸ - US Stock Trading Bot{% endblock %}

{% block content %}
<h1>ğŸ§ª í•œêµ­íˆ¬ìì¦ê¶Œ API í…ŒìŠ¤íŠ¸</h1>

<p style="color: #666; margin-bottom: 2rem;">API ì—°ë™ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë””ë²„ê¹… ë„êµ¬ì…ë‹ˆë‹¤. ëª¨ë“  ì£¼ë¬¸ì€ ìˆ˜ëŸ‰ 0ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ ì‹¤ì œ ê±°ë˜ê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

<!-- ì”ê³  ì¡°íšŒ í…ŒìŠ¤íŠ¸ -->
<div class="card">
    <h2>ğŸ“Š ì”ê³  ì¡°íšŒ (í•´ì™¸ì£¼ì‹)</h2>
    <p style="color: #666;">TR_ID: {% if paper_mode %}VTTS3012R (ëª¨ì˜íˆ¬ì){% else %}TTTS3012R (ì‹¤ì „íˆ¬ì){% endif %}</p>

    <button onclick="testBalance()" class="success">ì”ê³  ì¡°íšŒ í…ŒìŠ¤íŠ¸</button>

    <div id="balanceResult" style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px; display: none;">
        <h3 style="margin-top: 0;">ì‘ë‹µ ê²°ê³¼:</h3>
        <pre id="balanceData" style="white-space: pre-wrap; overflow-x: auto;"></pre>
    </div>
</div>

<!-- í˜„ì¬ê°€ ì¡°íšŒ í…ŒìŠ¤íŠ¸ -->
<div class="card">
    <h2>ğŸ’µ í˜„ì¬ê°€ ì¡°íšŒ</h2>
    <p style="color: #666;">TR_ID: HHDFS00000300</p>

    <div style="margin-bottom: 1rem;">
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì¢…ëª© ì½”ë“œ</label>
        <input type="text" id="priceTicker" value="AAPL" placeholder="AAPL" style="width: 200px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
    </div>

    <button onclick="testPrice()" class="success">í˜„ì¬ê°€ ì¡°íšŒ í…ŒìŠ¤íŠ¸</button>

    <div id="priceResult" style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px; display: none;">
        <h3 style="margin-top: 0;">ì‘ë‹µ ê²°ê³¼:</h3>
        <pre id="priceData" style="white-space: pre-wrap; overflow-x: auto;"></pre>
    </div>
</div>

<!-- ë§¤ìˆ˜ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸ -->
<div class="card">
    <h2>ğŸ“ˆ ë§¤ìˆ˜ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸ (ìˆ˜ëŸ‰ 0)</h2>
    <p style="color: #666;">TR_ID: {% if paper_mode %}VTTT1002U (ëª¨ì˜íˆ¬ì){% else %}TTTT1002U (ì‹¤ì „íˆ¬ì){% endif %}</p>

    <div style="margin-bottom: 1rem;">
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì¢…ëª© ì½”ë“œ</label>
        <input type="text" id="buyTicker" value="AAPL" placeholder="AAPL" style="width: 200px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
    </div>

    <div style="margin-bottom: 1rem;">
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì£¼ë¬¸ ìœ í˜•</label>
        <select id="buyOrderType" style="width: 200px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
            <option value="market">ì‹œì¥ê°€</option>
            <option value="limit">ì§€ì •ê°€</option>
        </select>
    </div>

    <div id="buyPriceDiv" style="margin-bottom: 1rem; display: none;">
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì§€ì •ê°€ê²©</label>
        <input type="number" id="buyPrice" value="100" placeholder="100.00" step="0.01" style="width: 200px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
    </div>

    <button onclick="testBuyOrder()" class="success">ë§¤ìˆ˜ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸ (ìˆ˜ëŸ‰ 0)</button>

    <div id="buyResult" style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px; display: none;">
        <h3 style="margin-top: 0;">ì‘ë‹µ ê²°ê³¼:</h3>
        <pre id="buyData" style="white-space: pre-wrap; overflow-x: auto;"></pre>
    </div>
</div>

<!-- ë§¤ë„ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸ -->
<div class="card">
    <h2>ğŸ“‰ ë§¤ë„ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸ (ìˆ˜ëŸ‰ 0)</h2>
    <p style="color: #666;">TR_ID: {% if paper_mode %}VTTT1001U (ëª¨ì˜íˆ¬ì){% else %}TTTT1006U (ì‹¤ì „íˆ¬ì){% endif %}</p>

    <div style="margin-bottom: 1rem;">
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì¢…ëª© ì½”ë“œ</label>
        <input type="text" id="sellTicker" value="AAPL" placeholder="AAPL" style="width: 200px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
    </div>

    <div style="margin-bottom: 1rem;">
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì£¼ë¬¸ ìœ í˜•</label>
        <select id="sellOrderType" style="width: 200px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
            <option value="market">ì‹œì¥ê°€</option>
            <option value="limit">ì§€ì •ê°€</option>
        </select>
    </div>

    <div id="sellPriceDiv" style="margin-bottom: 1rem; display: none;">
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì§€ì •ê°€ê²©</label>
        <input type="number" id="sellPrice" value="100" placeholder="100.00" step="0.01" style="width: 200px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
    </div>

    <button onclick="testSellOrder()" class="danger">ë§¤ë„ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸ (ìˆ˜ëŸ‰ 0)</button>

    <div id="sellResult" style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px; display: none;">
        <h3 style="margin-top: 0;">ì‘ë‹µ ê²°ê³¼:</h3>
        <pre id="sellData" style="white-space: pre-wrap; overflow-x: auto;"></pre>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    // ì£¼ë¬¸ ìœ í˜•ì— ë”°ë¼ ê°€ê²© ì…ë ¥ í‘œì‹œ/ìˆ¨ê¹€
    document.getElementById('buyOrderType').addEventListener('change', function() {
        document.getElementById('buyPriceDiv').style.display = this.value === 'limit' ? 'block' : 'none';
    });

    document.getElementById('sellOrderType').addEventListener('change', function() {
        document.getElementById('sellPriceDiv').style.display = this.value === 'limit' ? 'block' : 'none';
    });

    // ì”ê³  ì¡°íšŒ í…ŒìŠ¤íŠ¸
    async function testBalance() {
        const resultDiv = document.getElementById('balanceResult');
        const dataDiv = document.getElementById('balanceData');

        resultDiv.style.display = 'block';
        dataDiv.textContent = 'ì¡°íšŒ ì¤‘...';

        try {
            const response = await fetch('/api/test/balance');
            const data = await response.json();
            dataDiv.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
            dataDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
        }
    }

    // í˜„ì¬ê°€ ì¡°íšŒ í…ŒìŠ¤íŠ¸
    async function testPrice() {
        const ticker = document.getElementById('priceTicker').value;
        const resultDiv = document.getElementById('priceResult');
        const dataDiv = document.getElementById('priceData');

        if (!ticker) {
            alert('ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
            return;
        }

        resultDiv.style.display = 'block';
        dataDiv.textContent = 'ì¡°íšŒ ì¤‘...';

        try {
            const response = await fetch(`/api/test/price/${ticker}`);
            const data = await response.json();
            dataDiv.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
            dataDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
        }
    }

    // ë§¤ìˆ˜ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸
    async function testBuyOrder() {
        const ticker = document.getElementById('buyTicker').value;
        const orderType = document.getElementById('buyOrderType').value;
        const price = orderType === 'limit' ? document.getElementById('buyPrice').value : 0;
        const resultDiv = document.getElementById('buyResult');
        const dataDiv = document.getElementById('buyData');

        if (!ticker) {
            alert('ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
            return;
        }

        if (!confirm(`${ticker} ë§¤ìˆ˜ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ìˆ˜ëŸ‰ 0)`)) {
            return;
        }

        resultDiv.style.display = 'block';
        dataDiv.textContent = 'ì£¼ë¬¸ ì¤‘...';

        try {
            const response = await fetch('/api/test/buy', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    ticker: ticker,
                    quantity: 0,
                    price: parseFloat(price),
                    order_type: orderType
                })
            });
            const data = await response.json();
            dataDiv.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
            dataDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
        }
    }

    // ë§¤ë„ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸
    async function testSellOrder() {
        const ticker = document.getElementById('sellTicker').value;
        const orderType = document.getElementById('sellOrderType').value;
        const price = orderType === 'limit' ? document.getElementById('sellPrice').value : 0;
        const resultDiv = document.getElementById('sellResult');
        const dataDiv = document.getElementById('sellData');

        if (!ticker) {
            alert('ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
            return;
        }

        if (!confirm(`${ticker} ë§¤ë„ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ìˆ˜ëŸ‰ 0)`)) {
            return;
        }

        resultDiv.style.display = 'block';
        dataDiv.textContent = 'ì£¼ë¬¸ ì¤‘...';

        try {
            const response = await fetch('/api/test/sell', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    ticker: ticker,
                    quantity: 0,
                    price: parseFloat(price),
                    order_type: orderType
                })
            });
            const data = await response.json();
            dataDiv.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
            dataDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
        }
    }
</script>
{% endblock %}
